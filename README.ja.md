# AI CLI Launcher (AI プログラミングワークベンチ)

> 🌐 [English](README.md) | [中文](README.zh.md) | **日本語**

## 1. はじめに

**AI CLI Launcher** は、PowerShell をベースに作成された軽量ターミナルランチャーツールです。現代の AI 支援プログラミングシーン向けに設計され、さまざまな AI CLI ツール（`kiro-cli`、`Claude Code`、`Kimi CLI`、`Cursor Agent`、`OpenCode` など）を一元管理し、素早く起動することを目的としています。

このツールは、Windows ネイティブ環境と Windows Subsystem for Linux (WSL) の間の壁を取り払い、開発者が統一されたターミナルインターフェースでターゲットプロジェクトを選択し、ワンクリックで対応する AI プログラミングツールを起動し、パス変換とターミナル環境の初期化を自動的に完了させることができます。

> 📚 **サポートされているツール**: ツールの詳細なリスト、インストール手順、比較については、[docs/TOOLS.ja.md](docs/TOOLS.ja.md) を参照してください

## 2. 主な機能

* **🤖 インテリジェント二重環境検出**: 起動時に Windows ホストと WSL 環境にインストールされた AI CLI ツールを自動的に検出し、`[Win]` または `[WSL]` ラベルで分類します。
* **📂 統合プロジェクト管理**: `config.json` を通じてプロジェクトパスを一元管理し、クロスドライブ・クロス環境をサポートします。
* **🔄 クロス環境パス変換**: 内蔵のパス変換エンジンが、Windows 絶対パス（例：`C:\Projects\...`）を WSL 準拠のマウントパス（例：`/mnt/c/Projects/...`）に自動的に変換します。
* **⚡ 純粋なターミナルインタラクション**: キーボード駆動の CLI インターフェース、GUI の読み込み遅延なし、即時応答。
* **🔁 ループ起動モード**: プログラムは終了せず、ツールとプロジェクトの連続選択をサポートし、作業効率を向上させます。
* **📑 マルチタブサポート**: Ctrl+Enter で Windows Terminal の新規タブでツールを起動し、マルチタスク管理を容易にします。
* **🛠️ ツールインストール機能**: I キーを押して、インストールされていない AI CLI ツールをすばやくインストールします。
* **🏷️ 動的タブ命名**: 起動時に ANSI エスケープシーケンスと Windows ネイティブコマンドを通じて、ターミナルタブタイトル（例：`KIRO-CLI BT2400`）を動的に変更し、マルチタスク管理の明確性を大幅に向上させます。

---

## 3. インストールと設定ガイド

### 3.1 環境要件

* オペレーティングシステム：Windows 10 / Windows 11
* ランタイム環境：PowerShell 5.1 以上
* 依存関係：WSL がインストールおよび設定されていること（Linux ツールを使用する場合）

### 3.2 クイックインストール（推奨）

プロジェクトは自動インストールスクリプトを提供しています。以下のコマンドを実行するだけでインストールが完了します：

```powershell
irm https://raw.githubusercontent.com/hyfhot/AI-CLI/master/install.ps1 | iex
```

インストールスクリプトは自動的に以下を実行します：
1. GitHub から最新バージョンをダウンロード（アイコンファイルを含む）
2. プログラムファイルを `%LOCALAPPDATA%\AI-CLI` ディレクトリにコピー
3. デスクトップショートカットを作成（カスタムアイコン付き）
4. システム PATH 環境変数に追加

インストール完了後、以下の方法で起動できます：
- デスクトップの "AI-CLI" ショートカットをダブルクリック
- コマンドラインで `ai-cli` を実行（ターミナルの再起動が必要）

**一般的なコマンド：**
```powershell
ai-cli           # インタラクティブインターフェースを起動
ai-cli --help    # ヘルプ情報を表示
ai-cli --init    # 設定を初期化
ai-cli --config  # 設定を編集
```

**アンインストールコマンド：**
```powershell
ai-cli -Uninstall
```

PATH にまだ追加されていない場合は、以下を使用してアンインストールできます：
```powershell
& "$env:LOCALAPPDATA\AI-CLI\ai-cli.ps1" -Uninstall
```

**パラメータの説明**: `-` と `--` の両方のパラメータプレフィックスをサポートしています。例：`-Init` と `--init` は同等です（大文字小文字を区別しません）。

### 3.3 手動デプロイ手順

**ステップ 1: プロジェクトのクローンまたはダウンロード**
```powershell
git clone https://github.com/hyfhot/AI-CLI.git
cd AI-CLI
```

**ステップ 2: 設定の初期化**
```powershell
.\ai-cli.ps1 -Init
```

これにより、ユーザー設定ディレクトリ（`%APPDATA%\AI-CLI\config.json`）に設定ファイルが作成されます。プログラムディレクトリにデフォルトの設定がある場合は自動的にコピーされます。それ以外の場合は、新しい設定が作成されます。

設定ファイルを手動で編集してプロジェクトを追加できます：

```json
{
  "projects": [
    {
      "name": "プロジェクト名",
      "path": "C:\\Projects\\MyProject",
      "description": "プロジェクトの説明（オプション）"
    }
  ]
}
```

**ステップ 3: プログラムの実行**
```powershell
.\ai-cli.ps1
```

**ヘルプの表示**
```powershell
.\ai-cli.ps1 --help
```

---

## 4. 使用手順

### 4.1 起動とインターフェースの説明

`ai-cli` を実行すると、純粋なターミナルインタラクションインターフェースに入ります：

#### プロジェクト選択インターフェース（ツリー構造）
```
=== プロジェクトを選択 ===
> 📁 フロントエンドプロジェクト (3 件)
  📁 バックエンドプロジェクト (2 件)
  📄 スタンドアローンプロジェクト (C:\Projects\standalone)

[↑↓] 選択  [Enter] 入室/確認  [N] 新規  [D] 削除  [Q] 終了
```

フォルダに入った後：
```
  Home > フロントエンドプロジェクト

=== プロジェクトを選択 ===
> 📄 Vue プロジェクト (C:\Projects\vue-app)
  📁 React プロジェクト (2 件)
  📄 Angular プロジェクト (C:\Projects\angular-app)

[↑↓] 選択  [Enter] 入室/確認  [N] 新規  [D] 削除  [Esc] 戻る  [Q] 終了
```

#### ツール選択インターフェース
```
=== AI ツールを選択 (プロジェクト：プロジェクト 1) ===
> [WSL] kiro-cli
  [Win] claude
  [WSL] opencode
  [Win] aider

[↑↓] 選択  [Enter] 起動  [Ctrl+Enter] 新規タブ  [I] インストール  [Esc] 戻る  [Q] 終了
```

#### 新規作成インターフェース（タイプ選択）
```
=== タイプを選択 ===
> 📄 プロジェクト
  📁 フォルダ

[↑↓] 選択  [Enter] 確認  [Esc] キャンセル
```

#### 削除確認インターフェース
```
=== 削除確認 ===
プロジェクト名：MyProject_

プロジェクト名：MyProject
プロジェクトパス：C:\Projects\MyProject
環境変数（オプション、Enter キーでスキップ）:
  形式：KEY=VALUE、1 行 1 つ、空行で終了
  環境変数：API_KEY=sk-xxx
    追加済み：API_KEY=sk-xxx
削除予定：📁 フロントエンドプロジェクト (5 件を含む)

⚠️  警告：この操作は元に戻せません！
削除を確認するには名前を入力してください：フロントエンドプロジェクト_

[名前を入力] 確認  [Esc] キャンセル
```

### 4.2 キーボードショートカット

#### プロジェクト選択インターフェース
- `↑↓` - ナビゲーション選択
- `Enter` - フォルダに入るまたはプロジェクトを選択
- `N` - 新しいプロジェクトまたはフォルダ
- `D` - プロジェクトまたはフォルダを削除
- `Esc` - 親フォルダに戻る
- `Q` - プログラムを終了

#### ツール選択インターフェース
- `↑↓` - ナビゲーション選択
- `Enter` - 新しいウィンドウでツールを起動
- `Ctrl+Enter` - 新しいタブでツールを起動（Windows Terminal が必要）
- `I` - 新しいツールをインストール
- `Esc` - プロジェクト選択に戻る
- `Q` - プログラムを終了

#### 新規作成インターフェース
- プロジェクト名を入力（必須、重複不可）
- プロジェクトパスを入力（必須、パスの存在を自動検出）
- 環境変数を入力（オプション、形式：KEY=VALUE）
- 追加を確認またはキャンセル

### 4.3 ツリー構造管理

プロジェクトはツリー構造の組織をサポートしています：
- **フォルダ**: プロジェクトの分類管理に使用され、プロジェクトとサブフォルダを含めることができます
- **プロジェクト**: 実際の作業ディレクトリ、パスと環境変数を含む
- **パンくずリストナビゲーション**: 現在位置を表示し、マルチレベルナビゲーションに便利
- **再帰的削除**: フォルダを削除するときに含まれるアイテムの数を表示

### 4.4 実行効果

* スクリプトは自動的に該当するターミナル（Cmd または WSL）を起動します。
* ターミナルは自動的に選択されたプロジェクトの対応するパスに `cd` します。
* プロジェクトで設定された環境変数は、実行環境に自動的に注入されます。
  * **インテリジェントパス変換**: WSL 環境では、Windows パス形式の環境変数値（例：`C:\Projects\...`）が WSL パス形式（`/mnt/c/Projects/...`）に自動的に変換されます。
* ターミナル上部のタブ名は自動的に `[ツール名] [プロジェクト名]` に変更され、マルチインスタンスの識別に便利です。

---

## 5. 技術アーキテクチャと実装原理

### 5.1 ツリー構造の実装

プロジェクト設定は再帰的なツリー構造を使用しています：
```json
{
  "projects": [
    {
      "type": "folder",
      "name": "フロントエンドプロジェクト",
      "children": [
        {
          "type": "project",
          "name": "Vue プロジェクト",
          "path": "C:\\Projects\\vue-app"
        }
      ]
    }
  ]
}
```

- 古いバージョンのフラット設定をツリー構造に自動的に移行
- 再帰的なトラバース、追加、削除操作をサポート
- パンくずリストナビゲーションが現在のパスを追跡

### 5.2 パス解決エンジン (`ConvertTo-WslPath`)

正規表現 `^([a-zA-Z]):(.*)` を使用して Windows ドライブ文字を取得し、`/mnt/小文字のドライブ文字` 形式に変換し、バックスラッシュ `\` をフォワードスラッシュ `/` に置き換えて、WSL が Windows ファイルシステムを正しくマウントおよびアクセスできるようにします。

### 5.3 ツール検出メカニズム

* **Windows 環境**: PowerShell 組み込み cmdlet `Get-Command -ErrorAction SilentlyContinue` を使用して、低オーバーヘッドのサイレント検出を実行します。
* **WSL 環境**: `wsl.exe -e bash -ic "command -v tool"` を通じて検出を実行し、`-ic` パラメータを使用して `.bashrc` 環境変数がロードされることを保証します。

### 5.4 ターミナル起動とプロセス配布

ツール環境フラグ（`[Win]` / `[WSL]`）に基づいて、異なる戦略を実行します：

* **WSL の場合**:
`-e bash -ic` を組み合わせて使用し、完全な Linux 環境変数がロードされることを保証し（`command not found` などの問題を解決）、`echo -ne '\033]0;TITLE\007'` を使用して ANSI シーケンスを送信し、ターミナルタイトルを設定します。
* **Windows の場合**:
`cmd.exe /k` を使用してコンソールウィンドウを開いたままにし、`title` コマンドを通じてタイトルを変更し、`cd /d` を使用して安全なクロスドライブディレクトリ切り替えを実現します。

---

## 6. ツールインストール機能

### 6.1 使用方法

ツール選択インターフェースで `I` キーを押すと、ツールインストールインターフェースに入ります：

```
=== AI ツールをインストール ===
> [WSL] kiro-cli
  [Win] gemini
  [WSL] cursor-agent

[↑↓] 選択  [Enter] インストール  [Esc] 戻る  [Q] 終了
```

インストールするツールを選択し、Enter キーを押して確認すると、プログラムは自動的にインストールコマンドを実行します。

### 6.2 サポートされているツール

`config.json` 設定によると、現在 8 つのメインストリーム AI CLI ツールのインストールをサポートしています。詳細については、[docs/TOOLS.ja.md](docs/TOOLS.ja.md) と [docs/INSTALL-GUIDE.ja.md](docs/INSTALL-GUIDE.ja.md) を参照してください。

---

## 7. 設定ファイルの説明

設定ファイルの場所：`%APPDATA%\AI-CLI\config.json`（通常は `C:\Users\<ユーザー名>\AppData\Roaming\AI-CLI\config.json`）

**設定の優先順位**:
1. ユーザー設定ディレクトリの `config.json` を優先的に読み取る
2. 存在しない場合は、プログラムディレクトリのデフォルトの `config.json` を読み取る
3. すべての変更はユーザー設定ディレクトリに保存される

**注意**: 設定ファイルはプログラムとは別に保存され、プログラムをアンインストールしても設定は失われません。

### 7.1 config.json の構造

```json
{
  "projects": [
    {
      "name": "プロジェクト名",
      "path": "プロジェクトパス",
      "description": "プロジェクトの説明（オプション）",
      "env": {
        "API_KEY": "your-api-key",
        "DEBUG": "true"
      }
    }
  ],
  "tools": [
    {
      "name": "ツールコマンド",
      "displayName": "表示名",
      "winInstall": "Windows インストールコマンドまたは null",
      "wslInstall": "WSL インストールコマンドまたは null",
      "checkCommand": "検出コマンド",
      "url": "公式ウェブサイト"
    }
  ],
  "settings": {
    "language": "auto",
    "defaultEnv": "wsl",
    "terminalEmulator": "default"
  }
}
```

### 7.2 プロジェクトの追加

`config.json` を編集し、`projects` 配列に追加します：

```json
{
  "name": "MyProject",
  "path": "C:\\Projects\\MyProject",
  "description": "マイプロジェクト"
}
```

### 7.3 カスタムツールの追加

`config.json` を編集し、`tools` 配列に追加します：

```json
{
  "name": "mytool",
  "displayName": "マイツール",
  "winInstall": "npm install -g mytool",
  "wslInstall": "npm install -g mytool",
  "checkCommand": "mytool --version",
  "url": "https://mytool.com"
}
```

---

## 8. よくある質問 (FAQ)

**Q1: 新しいプロジェクトを追加するには？**
`config.json` ファイルを編集し、`projects` 配列にプロジェクト情報を追加するか、`ai-cli -Init` を実行して設定を再初期化します。

**Q2: 実行時にツールが見つからないというメッセージが表示される？**
1. ツールが正しくインストールされていることを確認する
2. PATH 環境変数を確認する
3. WSL ツールの場合、WSL 環境が正しく設定されていることを確認する
4. `ai-cli` を実行してツールを再検出する

**Q3: WSL 起動後に `No such file or directory` と表示される？**
プロジェクトパスが正しいか確認し、そのドライブ（C ドライブ、D ドライブなど）が WSL によって正常にマウントされていることを確認します。

**Q4: マルチタブ機能を使用するには？**
Windows Terminal がインストールされていることを確認し、ツール選択インターフェースで `Ctrl+Enter` を押してツールを起動します。

**Q5: アンインストールするには？**
`ai-cli -Uninstall` または `& "$env:LOCALAPPDATA\AI-CLI\ai-cli.ps1" -Uninstall` を実行します。

---

## 9. 関連ドキュメント

- **[docs/TOOLS.ja.md](docs/TOOLS.ja.md)** - 8 つのメインストリーム AI CLI ツールの詳細なリファレンスマニュアル
- **[docs/INSTALL-GUIDE.ja.md](docs/INSTALL-GUIDE.ja.md)** - ツールインストール機能の使用ガイド
- **[docs/BUGFIX.ja.md](docs/BUGFIX.ja.md)** - バグ修正記録と技術詳細
- **[docs/CHANGELOG.ja.md](docs/CHANGELOG.ja.md)** - バージョン更新ログ

---

*最終更新日：2026-02-26*
